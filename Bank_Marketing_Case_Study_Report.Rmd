---
title: "Bank Marketing Case Study 1"
author: "Dominica Peri"
date: "2025-09-08"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

1. Executive Summary (Last)

2. The Problem
    1. Introduction/Background
    2. Purpose of study/importance of study/statement of problem
    3. Questions to be answered/conceptual statement of hypotheses
    4. Outline of remainder of report (brief)
    
3. Review of Related Literature
    1. Acquaint reader with existing methodologies used in this area
    
4. Methodology
    1. Identification, classification and operationalization of variables.
    2. Statements of hypotheses being tested and/or models being developed.
    3. Sampling techniques, if full data is not being used.
    4. Data collection process, including data sources, data size, etc. Primary/secondary?
    5. Modeling analysis/techniques used
    6. Methodological assumptions and limitations.
    
5. Data
    1. Data cleaning
    2. Data preprocessing
    3. Data limitations
    
6. Findings (Results)
    1. Results presented in tables or charts when appropriate
    2. Results reported with respect to hypotheses/models.
    3. Factual information kept separate from interpretation, inference and evaluation.
    
7. Conclusions and Recommendations
    1. Discuss alternative methodologies

#____________________________________________________________________________

Load Libraries

```{r Libraries}
library(MASS) 
library(ggplot2)
library(tidyverse)
library(corrplot)
library(car)
library(GGally)
library(ROCR)
library(data.table)
library(Hmisc)
library(tibble)
library(knitr)
library(here)
library(ROCR)
```

Import Data

```{r}
data_path <- "https://raw.githubusercontent.com/kccasey1985/Case-Study-Bank-Marketting-/main/bank-additional-full.csv"

df <- fread(data_path, sep = ";") |> as_tibble()
glimpse(df)
```
```{r}
opts_knit$set(root.dir = here())

# load the dataset
df <- fread(here("bank-additional-full.csv"), sep = ";") |> as_tibble()
glimpse(df)
```


```{r }

head(df)

```


```{r }

str(df)

```

```{r}

summary(df)

```

```{r }

df2 <- df |> 
  mutate(job = factor(job),
         marital  = factor(marital),
         education  = factor(education),
         default  = factor(default),
         loan  = factor(loan),
         contact  = factor(contact),
         month   = factor(month),
         day_of_week  = factor(day_of_week),
         poutcome    = factor(poutcome),
         y   = factor(y),
         housing  = factor(housing))



```

```{r }

str(df2)

```

```{r }

summary(df2)

```
```{r }

anyNA(df2)

```

```{r }

df2 <- df2 |> mutate(age= cut(age, breaks = c(20, 30, 40, 50, 60, 70, 100),
                         labels = c("21-30", "31-40", "41-50", "51-60", "61-70", "71+"),
                         right = F))|>
            select(-duration)

```

```{r }

summary(df2)

```


```{r }

df2_num <- dplyr::select_if(df2, is.numeric)
matrix = cor(df2_num)
corrplot(matrix, method = c("number")) 

```







```{r }

corrplot::corrplot(matrix, method = "circle")


```





```{r }

lm_model <- lm(y ~ ., data = df2)

```
```{r}

# Make sure y is a factor with two levels
df2$y <- factor(df2$y, levels = c("no", "yes"))

# Logistic regression
logit_model <- glm(y ~ ., data = df2, family = binomial)

summary(logit_model)

```
```{r}
alias(lm_model)

```

`



```{r }

vif_values <- car::vif(lm_model)

print(vif_values)


```
```{r}

#remove factors with greater than 0.875 correlation with other factors

df3 <- subset(df2, select = -c(emp.var.rate,cons.price.idx,euribor3m,nr.employed))


df3

```

```{r}
#redo correction matrix with removed factors with greater than 0.875 correlation with other factors
df3_num <- dplyr::select_if(df3, is.numeric)
matrix2 = cor(df3_num)
corrplot(matrix2, method = c("number")) 


```



```{r}

# Logistic regression with df3

lm_model_2 <- lm(y ~ . , data = df3)

```


```{r}

logit_model2 <- glm(y ~ ., data = df3, family = binomial)

summary(logit_model2)




```

```{r}

# Make sure y is a factor with two levels
df3$y <- factor(df3$y, levels = c("no", "yes"))

# Logistic regression
logit_model <- glm(y ~ ., data = df3, family = binomial)

summary(logit_model)

```

```{r}
#LDA

# Ensure clean data for both models
df_clean <- df3[complete.cases(df3), ]

# Train logistic model (already done earlier, so skip if done)
# logit_model <- glm(y ~ ., data = df_clean, family = binomial)

# Train LDA model
library(MASS)
lda_model <- lda(y ~ ., data = df_clean)

summary(lda_model)

```

```{r}

# Predict probabilities
logit_probs <- predict(logit_model, newdata = df_clean, type = "response")
logit_pred <- prediction(logit_probs, df_clean$y)
logit_perf <- performance(logit_pred, "tpr", "fpr")

# Plot ROC
plot(logit_perf, col = "blue", lwd = 2,
     main = "ROC Curve: Logistic Regression")
abline(a = 0, b = 1, lty = 2, col = "gray")

# AUC
logit_auc <- performance(logit_pred, "auc")@y.values[[1]]
print(paste("Logistic Regression AUC:", round(logit_auc, 4)))
```

```{r}
# Predict probabilities from LDA
lda_pred <- predict(lda_model, newdata = df_clean)
lda_probs <- lda_pred$posterior[, 2]

# ROC and AUC for LDA
lda_roc <- prediction(lda_probs, df_clean$y)
lda_perf <- performance(lda_roc, "tpr", "fpr")

# Plot ROC
plot(lda_perf, col = "red", lwd = 2,
     main = "ROC Curve: Linear Discriminant Analysis")
abline(a = 0, b = 1, lty = 2, col = "gray")

# AUC
lda_auc <- performance(lda_roc, "auc")@y.values[[1]]
print(paste("LDA AUC:", round(lda_auc, 4)))

```
```{r}
# Create a data frame with model performance
model_summary <- data.frame(
  Model = c("Logistic Regression", "LDA"),
  AUC = c(round(logit_auc, 4), round(lda_auc, 4))
)

# Display the table nicely
knitr::kable(model_summary, caption = "Model Performance Summary (AUC)")

```
```{r}
# Logistic predicted classes
logit_pred_class <- ifelse(predict(logit_model, newdata = df_clean, type = "response") > 0.5, "yes", "no")

# LDA predicted classes
lda_pred_class <- predict(lda_model, newdata = df_clean)$class

```

```{r}
# Load required package
library(caret)

# Convert actual target
actual <- df_clean$y

# Confusion matrices
logit_cm <- confusionMatrix(factor(logit_pred_class, levels = c("no", "yes")), actual, positive = "yes")
lda_cm   <- confusionMatrix(factor(lda_pred_class, levels = c("no", "yes")), actual, positive = "yes")
print(logit_cm)
```
```{r}
# Get metrics from confusion matrix
logit_metrics <- logit_cm$byClass
lda_metrics   <- lda_cm$byClass

# Combine into table
model_metrics <- data.frame(
  Model       = c("Logistic Regression", "LDA"),
  Accuracy    = c(logit_cm$overall["Accuracy"], lda_cm$overall["Accuracy"]),
  Sensitivity = c(logit_metrics["Sensitivity"], lda_metrics["Sensitivity"]),
  Specificity = c(logit_metrics["Specificity"], lda_metrics["Specificity"]),
  AUC         = c(round(logit_auc, 4), round(lda_auc, 4))
)
# Display the table nicely
knitr::kable(model_metrics, caption = "Model Performance Metrics")
```


